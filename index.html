<!-- index.html -->
<html>
	<head>
		<title>How Startup Financing Works</title>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<style>
			body {
				width: 800px;
				margin: 2em;
				font-size: 150%;
			}

			h1 {
				color: #541714;
				text-align: center;
				margin-bottom: 0px;
			}

			h1 .title {
				font-size: 200%;
				color: #cc9e61;
				font-weight: 900;
			}

			p:not(:first-of-type), div.p {
				text-indent: 1em;
			}

			p:first-of-type:first-letter {
				float:left;
				color: #541714;
				font-size: 3em;
				line-height: 3em;
			}

			div.p {
				margin: 24px 0px;
			}

			p strong {
				color: #541714;
			}

			.controls {
				text-align: center;
			}

			.valuecontrolvertical {
				width: 280px;
			}

			.valuecontrol {
				text-align: center;
				text-indent: 0px;
				display: inline-block;
				border-radius: 6px;
				background-color: #938172;
				color: #020304;
				margin: 1px;
				vertical-align: middle;
			}

			.valuecontrol:hover {
				opacity: 0.9;
			}

			.valuecontrol .title {
				padding: 0.5em 0.5em 0 0.5em;
				font-weight: bold;
			}

			.valuecontrol .inlinetitle {
				display: inline-block;
			}

			.valuecontrol .inlinetitle:first-child {
				padding: 0.5em 0em 0.25em 0.5em;
			}

			.valuecontrol .inlinetitle:last-child {
				padding: 0.5em 0.5em 0.25em 0em;
			}

			.valuecontrol .value {
				padding: 0em 0.5em 0.25em 0.5em;
			}

			.valuecontrol .control {
				margin: 0px;
				padding: 0px;
			}

			.valuecontrol .control input {
				margin: 0px;
				padding: 0px;
			}
			.and {
				font-weight: bold;
				margin: 0.5em;
				color: #541714;
			}

			.chart {
				text-align: center;
			}

			path {  stroke: #fff; }
			path:hover {  opacity:0.9; }
			rect:hover {  fill:blue; }
			.axis {  font: 10px sans-serif; }
			.legend tr{    border-bottom:1px solid grey; }
			.legend tr:first-child{    border-top:1px solid grey; }

			.axis path,
			.axis line {
				fill: none;
				stroke: #000;
				shape-rendering: crispEdges;
			}

			.x.axis path {  display: none; }
			.legend{
				margin-bottom:76px;
				display:inline-block;
				border-collapse: collapse;
				border-spacing: 0px;
			}
			.legend td{
				padding:4px 5px;
				vertical-align:bottom;
			}
			.legendFreq, .legendPerc{
				align:right;
				width:50px;
			}

			.byline {
				text-align: right;
				font-style: italic;
				font-size: smaller;
			}

			.byline a {
				text-decoration: none;
				color: #cc9e61;
				margin-left: 4px;
				font-style: normal;
			}

			.gravatar {
				vertical-align: middle;
			}
		</style>
	</head>
	<body>
		<h1>How <span class="title">Startup Financing</span> Works</h1>
		<div class="byline">
			by <img class="gravatar" src="https://secure.gravatar.com/avatar/b29a6f56dcf2607af909970c17fee58e?d=mm&amp;s=40" style="width: 40px; height: 40px;"><a href="http://www.myshoggoth.com/">Andrew Boardman</a>
		</div>

		<p>Founders own 100% of a company until they raise money. You then have two levers to determine ownership after the investment.</p>
		<div class="controls">
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">
					Pre-Money Valuation
				</div>
				<div class="control">
					<input type="range" name="points" min="0" max="20000000" step="100000" value="0" id="slider-premoney" style="width: 100%;">
				</div>
				<div class="value" id="premoney"></div>
			</div>
			<span class="and">and</span>
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">
					Investment Size
				</div>
				<div class="control">
					<input type="range" name="points" min="0" max="20000000" step="100000" value="0" id="slider-investment" style="width: 100%;">
				</div>
				<div class="value" id="investment"></div>
			</div>
		</div>
		<div id="premoney-chart" class="chart"></div>
		<p>Stock options are created from the <strong>Option Pool</strong>, shares set aside by the company to attract and retain key employees.</p>
		<div class="p">The size of the
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">
					Option Pool
				</div>
				<div class="control">
					<input type="range" name="points" min="0" max="100" step="1" value="0" id="slider-optionpool" style="width: 100%;">
				</div>
				<div class="value" id="optionpool"></div>
			</div>	
			is often specified as a percentage of total shares.</div>
		<div class="p">It can be created from either the <div class="valuecontrol"><div class="inlinetitle">Pre-Money</div><input type="range" name="points" min="0" max="1" step="1" value="0" id="slider-optionpoolorigin" style="width: 60px;"><div class="inlinetitle">Post-Money</div></div> side.</div>
		<div id="optionpool-chart" class="chart"></div>
		<div class="p">A popular way to do early financing is through
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">Convertible Debt</div>
				<div class="control">
					<input type="range" name="points" min="0" max="20000000" step="100000" value="0" id="slider-debt" style="width: 100%;">
				</div>
				<div class="value" id="debt"></div>
			</div>, which allows the company to raise money while deferring the <strong>Valuation</strong> of the company until the next <strong>Financing Round</strong>, which must take place before the <strong>Term</strong> is up (or the debt must be renegotiated) to avoid having to <strong>pay it back to the investor</strong>, often with a <strong>Dividend</strong>.</div>
		<div class="p">To compensate the (usually) <strong>Angel Investors</strong> for taking the risk of lending their money to the company at an unknown <strong>Valuation</strong>, they normally ask for a
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">Discount</div>
				<div class="control">
					<input type="range" name="points" min="0" max="100" step="1" value="0" id="slider-debtdiscount" style="width: 100%;">
				</div>
				<div class="value" id="debtdiscount"></div>
			</div>
			to the next round's <strong>Share Price</strong>, and a <strong>Pre-Money Valuation</strong>
			<div class="valuecontrol valuecontrolvertical">
				<div class="title">Cap</div>
				<div class="control">
					<input type="range" name="points" min="0" max="20000000" step="100000" value="0" id="slider-debtcap" style="width: 100%;">
				</div>
				<div class="value" id="debtcap"></div>
			</div>, which does not affect other investors for that <strong>Financing Round</strong>. The <strong>Debt</strong> converts into the same type of stock as the next round of financing, with the same terms.
		</div>
		<div id="debt-chart" class="chart"></div>
		<script>
			var data = [
			{
				"name": "Founding",
				"stockType": "Restricted",
				"date": "01/01/2015",
				"preMoneyValuation": "0.0",
				"optionPoolPercent": "0.0",
				"optionPoolPreMoney": 't',
				"dividendCompounding": 't',
				"liquidationPref": "0.0",
				"dividendYield": "0.0",
				"liquidationCap": "0.0",
				"investments": [
				{
					"name": "Founders",
					"shares": "3000000"
				}
				]
			},
			{
				"name": "Seed",
				"stockType": "Convertible Debt",
				"date": "01/01/2015",
				"preMoneyValuation": "0.0",
				"optionPoolPercent": "0.0",
				"optionPoolPreMoney": 't',
				"dividendCompounding": 't',
				"liquidationPref": "0.0",
				"dividendYield": "0.0",
				"liquidationCap": "0.0",
				"investments": [
				{
					"name": "Angels",
					"amount": "500000",
					"term": "18",
					"discount": "0.2",
					"cap": "5000000"
				}
				]
			},
			{
				"name": "Series A",
				"stockType": "Convertible Preferred",
				"date": "02/01/2015",
				"preMoneyValuation": "3000000",
				"optionPoolPercent": "0.1",
				"optionPoolPreMoney": 't',
				"dividendCompounding": 't',
				"liquidationPref": "2.0",
				"dividendYield": "10.0",
				"liquidationCap": "5.0",
				"investments": [
				{
					"name": "Investors",
					"amount": "2000000"
				}
				]
			}
			];

			function updatePreMoney() {
				d3.select("#slider-premoney").property("value", data[2].preMoneyValuation);
				d3.select("#premoney").text( "$" + d3.format(",")(data[2].preMoneyValuation) );
			}

			function updateInvestment() {
				d3.select("#slider-investment").property("value", data[2].investments[0].amount);
				d3.select("#investment").text( "$" + d3.format(",")(data[2].investments[0].amount) );
			}

			function updateOptionPool() {
				d3.select("#slider-optionpool").property("value", data[2].optionPoolPercent * 100);
				d3.select("#optionpool").text(d3.format("%")(data[2].optionPoolPercent) );
			}

			function updateOptionPoolOrigin() {
				d3.select("#slider-optionpoolorigin").property("value", data[2].optionPoolPreMoney == 't' ? 0 : 1);
			}

			function updateDebt() {
				d3.select("#slider-debt").property("value", data[1].investments[0].amount);
				d3.select("#debt").text( "$" + d3.format(",")(data[1].investments[0].amount) );
			}

			function updateDebtDiscount() {
				d3.select("#slider-debtdiscount").property("value", data[1].investments[0].discount * 100);
				d3.select("#debtdiscount").text(d3.format("%")(data[1].investments[0].discount) );
			}

			function updateDebtCap() {
				d3.select("#slider-debtCap").property("value", data[1].investments[0].cap);
				d3.select("#debtCap").text("$" + d3.format(",")(data[1].investments[0].cap) );
			}

			function segColor(c) {
				switch (c.name.toLowerCase()) {
					case "founders":
					color = "#541714";
					break;
					case "investors":
					color = "#938172";
					break;
					case "option pool":
					color = "#cc9e61";
					break;
					case "angels":
					color = "#626266";
					break;
				}
				return color;
			}

			function postmoney(round) {
				return parseFloat(round.preMoneyValuation) + parseFloat(round.investments[0].amount);
			}

			function percentOwnershipPreMoney(c) {
				percentOwnershipSeriesA = parseFloat(data[2].investments[0].amount) / postmoney(data[2])
				if (c.name == "Series A") {
					return percentOwnershipSeriesA;
				} else {
					return (1.0 - percentOwnershipSeriesA);
				}

			}

			function percentOwnershipOptionPool(c) {
				base = percentOwnershipPreMoney(c);
				optionPool = parseFloat(data[2].optionPoolPercent);
				if (data[2].optionPoolPreMoney == 't' && c.name == "Founding") {
					return Math.max(base - optionPool, 0.0);
				}
				if (data[2].optionPoolPreMoney == 'f') {
					return Math.max(base - (optionPool / 2.0), 0.0);
				}
				return base;
			}

			function percentOwnershipDebt(c) {
				if (data[1].investments[0].cap > 0)
				{
					effectivePreMoney = Math.min(parseInt(data[2].preMoneyValuation), parseInt(data[1].investments[0].cap));
				} else {
					effectivePreMoney = data[2].preMoneyValuation;
				}
				effectiveDebtAmount = parseInt(data[1].investments[0].amount) / (1.0 - parseFloat(data[1].investments[0].discount));
				effectiveDebtAmount = (parseInt(data[2].preMoneyValuation) / effectivePreMoney) * effectiveDebtAmount;
				totalShares = parseInt(data[0].investments[0].shares);
				postMoney = effectiveDebtAmount + parseInt(data[2].investments[0].amount) + parseInt(data[2].preMoneyValuation);
				if (data[2].optionPoolPreMoney == 't') {
					totalInvestorsChunk = (effectiveDebtAmount + parseInt(data[2].investments[0].amount)) / postMoney;
					investorPercent = parseInt(data[2].investments[0].amount) / postMoney;
					debtPercent = effectiveDebtAmount / postMoney;
					founderPercent = (1.0 - (totalInvestorsChunk + parseFloat(data[2].optionPoolPercent)));
				} else {
					totalPreShares = totalShares;
					effectivePps = parseInt(data[2].preMoneyValuation) / totalPreShares;
					debtShares = effectiveDebtAmount / effectivePps;
					investorShares = parseInt(data[2].investments[0].amount) / effectivePps;
					totalPostShares = totalShares + investorShares + debtShares;
					founderPercent = totalShares / totalPostShares;
					debtPercent = debtShares / totalPostShares;
					investorPercent = investorShares / totalPostShares;
				}
				switch (c.name) {
					case 'Founding':
						return founderPercent;
					case 'Seed':
						return debtPercent;
					case 'Series A':
						return investorPercent;
				}
			}

			function calcPreMoneyOwnerships(data) {
				return [
					{
						"name": data[0].investments[0].name,
						"percent": percentOwnershipPreMoney(data[0])
					},
					{
						"name": data[2].investments[0].name,
						"percent": percentOwnershipPreMoney(data[2])
					}
				];
			}

			function calcOptionPoolOwnerships(data) {
				return [
					{
						"name": data[0].investments[0].name,
						"percent": percentOwnershipOptionPool(data[0])
					},
					{
						"name": data[2].investments[0].name,
						"percent": percentOwnershipOptionPool(data[2])
					},
					{
						"name": "Option Pool",
						"percent": data[2].optionPoolPercent
					}
				];
			}

			function calcDebtOwnerships(data) {
				return [
					{
						"name": data[0].investments[0].name,
						"percent": percentOwnershipDebt(data[0])
					},
					{
						"name": data[2].investments[0].name,
						"percent": percentOwnershipDebt(data[2])
					},
					{
						"name": "Option Pool",
						"percent": data[2].optionPoolPercent
					},
					{
						"name": data[1].investments[0].name,
						"percent": percentOwnershipDebt(data[1])
					}
				];
			}

			function createChart(id, fData){

				// function to handle pieChart.
				function pieChart(pD){
					var pC ={},    pieDim ={w:250, h: 250};
					pieDim.r = Math.min(pieDim.w, pieDim.h) / 2;

					// create svg for pie chart.
					var piesvg = d3.select(id).append("svg")
					.attr("width", pieDim.w).attr("height", pieDim.h).append("g")
					.attr("transform", "translate("+pieDim.w/2+","+pieDim.h/2+")");

					// create function to draw the arcs of the pie slices.
					var arc = d3.svg.arc().outerRadius(pieDim.r - 10).innerRadius(0);

					// create a function to compute the pie slice angles.
					var pie = d3.layout.pie().sort(null).value(function(d) { return d.percent; });

					// Draw the pie slices.
					piesvg.selectAll("path").data(pie(pD)).enter().append("path").attr("d", arc)
					.each(function(d) { this._current = d; })
					.style("fill", function(d) { return segColor(d.data); });

					// create function to update pie-chart. This will be used by histogram.
					pC.update = function(nD){
						piesvg.selectAll("path").data(pie(nD)).transition().duration(10)
						.attrTween("d", arcTween);
					}        
					// Animating the pie-slice requiring a custom function which specifies
					// how the intermediate paths should be drawn.
					function arcTween(a) {
						var i = d3.interpolate(this._current, a);
						this._current = i(0);
						return function(t) { return arc(i(t));    };
					}    
					return pC;
				}

				// function to handle legend.
				function legend(lD){
					var leg = {};

					// create table for legend.
					var legend = d3.select(id).append("table").attr('class','legend');

					// create one row per segment.
					var tr = legend.append("tbody").selectAll("tr").data(lD).enter().append("tr");

					// create the first column for each segment.
					tr.append("td").append("svg").attr("width", '16').attr("height", '16').append("rect")
					.attr("width", '16').attr("height", '16')
					.attr("fill",function(d){ return segColor(d); });

					// create the second column for each segment.
					tr.append("td").text(function(d){ return d.type;});

					// create the third column for each segment.
					tr.append("td").attr("class",'legendName')
					.text(function(d){ return d.name; });

					// create the fourth column for each segment.
					tr.append("td").attr("class",'legendPerc')
					.text(function(d){ return d3.format("%")(d.percent); });

					// Utility function to be used to update the legend.
					leg.update = function(nD){
						// update the data attached to the row elements.
						var l = legend.select("tbody").selectAll("tr").data(nD);

						// update the frequencies.
						l.select(".legendFreq").text(function(d){ return d.name; });

						// update the percentage column.
						l.select(".legendPerc").text(function(d){ return d3.format("%")(d.percent);});
					}

					function getLegend(d,aD){ // Utility function to compute percentage.
						return d3.format("%")(d.percent/d3.sum(aD.map(function(v){ return d.percent; })));
					}

					return leg;
				}

				return [ pieChart(fData), legend(fData) ];
			}

			var preMoneyCharts = createChart('#premoney-chart', calcPreMoneyOwnerships(data));
			var optionPoolCharts = createChart('#optionpool-chart', calcOptionPoolOwnerships(data));
			var debtCharts = createChart('#debt-chart', calcDebtOwnerships(data));

			function updatePreMoneyCharts() {
				d = calcPreMoneyOwnerships(data);
				for (i = 0; i < preMoneyCharts.length; i++) {
					preMoneyCharts[i].update(d);
				}
			}
			function updateOptionPoolCharts(charts) {
				d = calcOptionPoolOwnerships(data);
				for (i = 0; i < optionPoolCharts.length; i++) {
					optionPoolCharts[i].update(d);
				}
			}
			function updateDebtCharts(charts) {
				d = calcDebtOwnerships(data);
				for (i = 0; i < debtCharts.length; i++) {
					debtCharts[i].update(d);
				}
			}
			updatePreMoney();
			updateInvestment();
			updateOptionPool();
			updateOptionPoolOrigin();
			updateDebt();
			updateDebtDiscount();
			updateDebtCap();

			function updateOnPreMoneyChange(value) {
				data[2].preMoneyValuation = parseInt(value);
				updatePreMoney();
				updatePreMoneyCharts();
				updateOptionPoolCharts();
				updateDebtCharts();
			}
			d3.select("#slider-premoney")
			.on("mousemove", function() {
				updateOnPreMoneyChange(this.value);
			});
			d3.select("#slider-premoney")
			.on("click", function() {
				updateOnPreMoneyChange(this.value);
			});

			function updateOnInvestmentChange(value) {
				data[2].investments[0].amount = parseInt(value);
				updateInvestment();
				updatePreMoneyCharts();
				updateOptionPoolCharts();
				updateDebtCharts();
			}
			d3.select("#slider-investment")
			.on("mousemove", function() {
				updateOnInvestmentChange(this.value);
			});
			d3.select("#slider-investment")
			.on("click", function() {
				updateOnInvestmentChange(this.value);
			});

			function updateOnOptionPoolChange(value) {
				data[2].optionPoolPercent = parseInt(value) / 100.0;
				updateOptionPool();
				updateOptionPoolCharts();
				updateDebtCharts();
			}
			d3.select("#slider-optionpool")
			.on("mousemove", function() {
				updateOnOptionPoolChange(this.value);
			});
			d3.select("#slider-optionpool")
			.on("click", function() {
				updateOnOptionPoolChange(this.value);
			});

			function updateOnOptionPoolOriginChange(value) {
				data[2].optionPoolPreMoney = (parseInt(value) == 0 ? 't' : 'f');
				updateOptionPoolOrigin();
				updateOptionPoolCharts();
				updateDebtCharts();
			}
			d3.select("#slider-optionpoolorigin")
			.on("mousemove", function() {
				updateOnOptionPoolOriginChange(this.value);
			});
			d3.select("#slider-optionpoolorigin")
			.on("click", function() {
				updateOnOptionPoolOriginChange(this.value);
			});

			function updateOnDebtChange(value) {
				data[1].investments[0].amount = parseInt(value);
				updateDebt();
				updateDebtCharts();
			}
			d3.select("#slider-debt")
			.on("mousemove", function() {
				updateOnDebtChange(this.value);
			});
			d3.select("#slider-debt")
			.on("click", function() {
				updateOnDebtChange(this.value);
			});

			function updateOnDebtDiscountChange(value) {
				data[1].investments[0].discount = parseInt(value) / 100.0;
				updateDebtDiscount();
				updateDebtCharts();
			}
			d3.select("#slider-debtdiscount")
			.on("mousemove", function() {
				updateOnDebtDiscountChange(this.value);
			});
			d3.select("#slider-debtdiscount")
			.on("click", function() {
				updateOnDebtDiscountChange(this.value);
			});

			function updateOnDebtCapChange(value) {
				data[1].investments[0].cap = parseInt(value);
				updateDebtCap();
				updateDebtCharts();
			}
			d3.select("#slider-debtcap")
			.on("mousemove", function() {
				updateOnDebtCapChange(this.value);
			});
			d3.select("#slider-debtterm")
			.on("click", function() {
				updateOnDebtCapChange(this.value);
			});
		</script>
	</body>
</html>
